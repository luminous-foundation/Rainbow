.extern i32 test(u8* a u64 stdOut) @"ffi_test/test.dll"
.extern void* GetStdHandle(i32 nStdHandle) @"Kernel32.dll"
.extern i32 WriteConsoleA(u64 hConsoleOutput u8* lpBuffer i32 nNumberOfCharsToWrite u64 lpNumberOfCharsWritten u64 lpReserved) @"Kernel32.dll"

.macro PRINT c {
    PMOV c text 0
    PUSH text
    PUSH handle
    CALL test
    POP _
}

void main() {
    VAR u8* text
    ALLOC u8 1 text
    PMOV 65 text 0

    VAR u64 handle

    PUSH -11
    CALL GetStdHandle
    POP handle

    PRINT 72
    PRINT 101
    PRINT 108
    PRINT 108
    PRINT 111
    PRINT 44

    PRINT 32

    PRINT 87
    PRINT 111
    PRINT 114
    PRINT 108
    PRINT 100
    PRINT 33

    PRINT 13
    PRINT 10
}